{"version":3,"file":null,"sources":["../src/gender-detection.ts"],"sourcesContent":["import $ from 'jquery';\n\n/**\n * This component uses Gender-api.com\n * When request is done it returns 3 possible values for gender: 'male', 'female', 'unknown'\n * Remember to set your inputs \n\n/**\n * component options interface.\n * Please refer to swiper documentation and our teaser component for more options and callbacks\n */\ninterface GenderDetectionOptions {\n    /**\n     * HTML Class of the input that will be listened for changes\n     * @type {string}\n     * @default 'cs-gender-detection__source'\n     */\n    sourceClass?: string;\n\n    /**\n     * HTML Class of the wrapper with gender inputs\n     * This wrapper is hidden by default, It is shown after gender is detected\n     * @type {string}\n     * @default 'cs-gender-detection__content'\n     */\n    inputsWrapperClass?: string;\n\n    /**\n     * When gender is detected, script will add a modifier to the wrapper\n     * @type {string}\n     * @default 'cs-gender-detection__content--active'\n     */\n    inputsWrapperActiveClass?: number;\n\n    /**\n     * Input selection delay defines if selection of input should be delayed\n     * It is useful if there's any transition for wrapper set in your case and you want to make\n     * selection happen \"on the eyes of customer\", not when fields are hidden in the first miliseconds of animation\n     * @default {0}\n     * @type {number}\n     */\n    delay?: number;\n\n    /**\n     * Ajax loading class - added to the documents' body\n     * Decided to attach it to body because in most cases ajax loader is global component\n     * This was it's more elastic \n     * @type {string}\n     */\n    ajaxLoadingClass?: string;\n}\n\nexport default class GenderDetection {\n    protected _apiKey: string;\n    protected _$element: JQuery;\n    protected _$source: JQuery;\n    protected _$optionsWrapper: JQuery;\n    protected _$output: JQuery;\n    protected _activeClass: string;\n    public _isEdited: boolean;\n    public options: any;\n\n    /**\n     * Creates new Gender Detection component with optional settings.\n     * @param {options} Optional settings object.\n     */\n    public constructor( _$element: any, options?: GenderDetectionOptions ) {\n        this.options = $.extend( true, {}, {\n            sourceClass: 'cs-gender-detection__source',\n            inputsWrapperClass: 'cs-gender-detection__content',\n            inputsWrapperActiveClass: 'cs-gender-detection__content--active',\n            delay: 0,\n        }, options );\n\n        this._$element = _$element;\n\n        // Read API key from data-api-key attribute\n        this._apiKey = this._$element.data( 'api-key' );\n        this._$source = this._$element.find( `.${ this.options.sourceClass }` );\n        this._$optionsWrapper = this._$element.find( `.${ this.options.inputsWrapperClass }` );\n\n        // Select output fields by data-gender attribute\n        this._$output = this._$optionsWrapper.find( '[data-gender]' );\n\n        // this._$output was not edited (selected manually) yet\n        this._isEdited = false;\n\n        // If input, options or apiKey is missing then stop script execution\n        if ( !this._$source.length && !this._$optionsWrapper.length && !this._apiKey && this._apiKey === '' ) {\n            return;\n        }\n\n        if ( this._$output.length ) {\n            this._setEvents();\n        }\n    }\n\n    /**\n     * Sets gender on frontend after delay if provided in options\n     * @param $output {JQuery} jquery element to set as :checked or that value should be set for.\n     * @param gender {String} Optional gender string ('male' / 'female')\n     */\n    protected _setGender( $output: any, gender?: string ): void {\n        setTimeout( (): void => {\n            if ( gender && gender !== '' ) {\n                $output.val( gender );\n            } else  {\n                $output.attr( 'checked', true );\n            }\n\n            if ( $output.data( 'selectpicker' ) ) {\n                $output.selectpicker( 'refresh' );\n            }\n\n        }, this.options.delay );\n\n        this._isEdited = true;\n    }\n\n    /**\n     * Prepares options wrapper: adds 'active' class and gets the actual target\n     * @param data {Object} data object returned by gender-api.com\n     */\n    protected _prepareOutput( data: any ): void {\n        let $output: any = this._$optionsWrapper.find( '[data-gender]' );\n\n        if ( this.options.inputsWrapperActiveClass ) {\n            this._$optionsWrapper.addClass( this.options.inputsWrapperActiveClass );\n        }\n\n        if ( $output.length && $output.is( 'select' ) && $output.find( `option[value=\"${ data.gender }\"]` ).length ) {\n            this._setGender( $output, data.gender );\n        } else if ( $output.length && ( $output.attr( 'type' ) === 'radio' || $output.attr( 'type' ) === 'checkbox' ) ) {\n            $output = $output.filter( function(): any { \n                return $( this ).data( 'gender' ) === data.gender;\n            } );\n\n            if ( $output.length ) {\n                this._setGender( $output );\n            }\n        }\n    }\n\n    /**\n     * Sends request to gender-api.com\n     * @param name {String} Name provided by user ( inputs' value )\n     */\n    protected _getData( name ): any {\n        return $.get( `https://gender-api.com/get?name=${ name }&key=${ this._apiKey }` );\n    }\n\n    /**\n     * Sets 'onchange' events\n     */\n    protected _setEvents(): void {\n        let _that: any = this;\n\n        // If gender is selected manually before name if provided or if it's edited later then set flag so that script knows not to check gender again\n        $( document ).on( 'change', `.${ this.options.inputsWrapperClass } input, .${ this.options.inputsWrapperClass } select`, (): void => {\n            _that._isEdited = true;\n        } );\n\n        // listed to 'onchange' on name input\n        $( document ).on( 'change', `.${ this.options.sourceClass }`, (): void => {\n            const name: string = _that._$source.val();\n\n            if ( name !== '' && !_that._isEdited ) {\n                // If ajax class defined in options, adds it to 'body'\n                if ( _that.options.ajaxLoadingClass ) {\n                    $( 'body' ).addClass( _that.options.ajaxLoadingClass );\n                }\n\n                _that._getData( name ).then( ( data: any ): void => {\n                    $( 'body' ).removeClass( _that.options.ajaxLoadingClass );\n                    _that._prepareOutput( data );\n                } );\n            }\n        } );\n    }\n}\n"],"names":[],"mappings":"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"}