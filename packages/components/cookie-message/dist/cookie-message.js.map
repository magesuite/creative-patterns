{"version":3,"file":null,"sources":["../src/cookie-message.ts"],"sourcesContent":["/* tslint:disable:no-unused-new object-literal-key-quotes max-classes-per-file */\nimport $ from 'jquery';\n\ninterface ICookieMessageSettings {\n    /**\n     * Defines cookie lifetime (in days!)\n     * @default {180}\n     * @type {number}\n     */\n    lifetime?: number;\n\n    /**\n     * Defines delay of component destroyment (in ms).\n     * Useful if there's an animation for hidding component after button is clicked.\n     * @default {250}\n     * @type {number}\n     */\n    destroyDelay?: number;\n\n    /**\n     * Defines url of Ajax request to set cookie. \n     * Value shouldn't contain origin url\n     * @default {cookie-message/set-cookie}\n     * @type {string}\n     */\n    ajaxUrl?: string;\n\n    /**\n     * On message shown callback\n     * @type {any}\n     */\n    onShown?: any;\n\n    /**\n     * On message destroyed callback\n     * @type {any}\n     */\n    onDestroyed?: any;\n}\n\n/**\n * CookieMessage displays legal cookie note on the bottom of the page due to EU law.\n */\nexport default class CookieMessage {\n    private _settings?: ICookieMessageSettings;\n    public $wrapper: JQuery;\n    public status: string;\n\n    /**\n     * Creates and initiates new CookieMessage component with given settings.\n     * @param  {$wrapper} JQuery components' wrapper.\n     * @param  {ICookieMessageSettings} settings Optional component settings.\n     */\n    public constructor( $wrapper: JQuery, settings?: ICookieMessageSettings ) {\n        this.status = 'not-fired';\n\n        if ( $wrapper.length ) {\n            this._settings = $.extend( true, {},\n                {\n                    lifetime: 180,\n                    destroyDelay: 250,\n                    ajaxUrl: 'cookie-message/set-cookie',\n                },\n                settings,\n            );\n\n            this.$wrapper = $wrapper;\n            this.showMessage();\n            this._setEvents();\n        }\n    }\n\n    /**\n     * Adds class to $wrapper that shows cookie message\n     */\n    public showMessage(): void {\n        this.$wrapper.addClass( 'cs-cookie-message--shown' );\n        this.status = 'active';\n\n        if ( this._settings.onShown && typeof( this._settings.onShown ) === 'function' ) {\n            this._settings.onShown();\n        }\n    }\n\n    /**\n     * Removes class to $wrapper that shows cookie message (hides it)\n     */\n    public hideMessage(): void {\n        this.$wrapper.removeClass( 'cs-cookie-message--shown' );\n        this.status = 'inactive';\n    }\n\n    /**\n     * Destroys component when it's no longer needed\n     */\n    public destroyMessage( $btn?: any ): void {\n        this.hideMessage();\n\n        setTimeout( (): void => {\n            this.$wrapper.remove();\n            this.status = 'destroyed';\n\n            if ( this._settings.onDestroyed && typeof( this._settings.onDestroyed ) === 'function' ) {\n                this._settings.onDestroyed();\n            }\n        }, this._settings.destroyDelay );\n\n        if ( $btn && $btn.length ) {\n            $btn.off( 'click' );\n        }\n    }\n\n    /**\n     * Returns base url of current page\n     * @return  {string} origin url.\n     */\n    private _getLocationOrigin(): string {\n        if ( typeof window.location.origin === 'undefined' ) {\n            return `${ window.location.protocol }//${ window.location.host }`;\n        }\n\n        return window.location.origin;\n    }\n\n    /**\n     * Sends AJAX request to backend to inform that cookie should be set.\n     * Additionally passes lifetime according to settings\n     */\n    private _setCookie(): void {\n        $.ajax( {\n            method: 'POST',\n            url: `${ this._getLocationOrigin() }/${ this._settings.ajaxUrl }`,\n            data: { cookieLifetime: this._settings.lifetime },\n        } );\n    }\n\n    /**\n     * Sets click event for agreement button\n     */\n    private _setEvents(): void {\n        let _this: any = this;\n        const $btn: any = this.$wrapper.find( 'button' );\n\n        if ( $btn.length ) {\n            $btn.on( 'click', function(): void {\n                _this._setCookie();\n                _this.destroyMessage( $btn );\n            } );\n        }\n    }\n}\n"],"names":[],"mappings":";;;;;;;;AAwCA;;;AAGe;;;;;;IAUX,uBAAoB,QAAgB,EAAE,QAAiC;QACnE,IAAI,CAAC,MAAM,GAAG,WAAW,CAAC;QAE1B,IAAK,QAAQ,CAAC,MAAO,EAAE;YACnB,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC,MAAM,CAAE,IAAI,EAAE,EAAE,EAC/B;gBACI,QAAQ,EAAE,GAAG;gBACb,YAAY,EAAE,GAAG;gBACjB,OAAO,EAAE,2BAA2B;aACvC,EACD,QAAQ,CACX,CAAC;YAEF,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;YACzB,IAAI,CAAC,WAAW,EAAE,CAAC;YACnB,IAAI,CAAC,UAAU,EAAE,CAAC;SACrB;KACJ;;;;IAKM,mCAAW,GAAlB;QACI,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAE,0BAA0B,CAAE,CAAC;QACrD,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC;QAEvB,IAAK,IAAI,CAAC,SAAS,CAAC,OAAO,IAAI,OAAM,CAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAE,KAAK,UAAW,EAAE;YAC7E,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC;SAC5B;KACJ;;;;IAKM,mCAAW,GAAlB;QACI,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAE,0BAA0B,CAAE,CAAC;QACxD,IAAI,CAAC,MAAM,GAAG,UAAU,CAAC;KAC5B;;;;IAKM,sCAAc,GAArB,UAAuB,IAAU;QAAjC,iBAeC;QAdG,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,UAAU,CAAE;YACR,KAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;YACvB,KAAI,CAAC,MAAM,GAAG,WAAW,CAAC;YAE1B,IAAK,KAAI,CAAC,SAAS,CAAC,WAAW,IAAI,OAAM,CAAE,KAAI,CAAC,SAAS,CAAC,WAAW,CAAE,KAAK,UAAW,EAAE;gBACrF,KAAI,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC;aAChC;SACJ,EAAE,IAAI,CAAC,SAAS,CAAC,YAAY,CAAE,CAAC;QAEjC,IAAK,IAAI,IAAI,IAAI,CAAC,MAAO,EAAE;YACvB,IAAI,CAAC,GAAG,CAAE,OAAO,CAAE,CAAC;SACvB;KACJ;;;;;IAMO,0CAAkB,GAA1B;QACI,IAAK,OAAO,MAAM,CAAC,QAAQ,CAAC,MAAM,KAAK,WAAY,EAAE;YACjD,OAAW,MAAM,CAAC,QAAQ,CAAC,QAAQ,UAAO,MAAM,CAAC,QAAQ,CAAC,IAAO,CAAC;SACrE;QAED,OAAO,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;KACjC;;;;;IAMO,kCAAU,GAAlB;QACI,CAAC,CAAC,IAAI,CAAE;YACJ,MAAM,EAAE,MAAM;YACd,GAAG,EAAM,IAAI,CAAC,kBAAkB,EAAE,SAAM,IAAI,CAAC,SAAS,CAAC,OAAU;YACjE,IAAI,EAAE,EAAE,cAAc,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE;SACpD,CAAE,CAAC;KACP;;;;IAKO,kCAAU,GAAlB;QACI,IAAI,KAAK,GAAQ,IAAI,CAAC;QACtB,IAAM,IAAI,GAAQ,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAE,QAAQ,CAAE,CAAC;QAEjD,IAAK,IAAI,CAAC,MAAO,EAAE;YACf,IAAI,CAAC,EAAE,CAAE,OAAO,EAAE;gBACd,KAAK,CAAC,UAAU,EAAE,CAAC;gBACnB,KAAK,CAAC,cAAc,CAAE,IAAI,CAAE,CAAC;aAChC,CAAE,CAAC;SACP;KACJ;IACL,oBAAC;CAAA,IAAA,AAED;;;;"}